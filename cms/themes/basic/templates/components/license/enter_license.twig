<div class="container my-4">
	<div class="row justify-content-center">
		<div
			class="col-12 col-lg-8">

			{# --- Top status / guidance ------------------------------------------------ #}
			{% if LicenseKeyIsDefined and RequireLicenseServer and RequireLicense and not LicenseAvailable %}
				<div class="alert alert-danger text-center" role="alert">
					<h3 class="h4 mb-2">License key required but none is loaded into CrispCMS</h3>
					<p class="mb-0">Please restart your container to load the key.</p>
				</div>
			{% elseif RequireLicense and not LicenseAvailable %}
				<div class="alert alert-danger text-center" role="alert">
					<h3 class="h4 mb-1">License key required</h3>
					<p class="mb-0">Install one using the form below.</p>
				</div>
			{% endif %}

			{# --- License Server: Enter License Key ----------------------------------- #}
			{% if RequireLicenseServer and not ENV.LICENSE_KEY %}
				<div class="card shadow-sm mb-4">
					<div class="card-header">
						<h2 class="h5 mb-0">Enter License</h2>
					</div>
					<div class="card-body">
						<form id="entkey" method="post" action="" enctype="multipart/form-data" novalidate>
							<div class="mb-3">
								<label for="key" class="form-label">License Key</label>
								<input name="key" class="form-control" type="text" id="key" required aria-describedby="keyHelp">
								<div id="keyHelp" class="form-text">
									You should have received this from your distributor.
								</div>
							</div>
							<div class="d-grid">
								<button class="btn btn-primary" type="submit">Submit</button>
							</div>
						</form>
					</div>
				</div>
			{% elseif not ENV.LICENSE_KEY %}

				{# --- Direct Upload: License / Issuer / Instance ------------------------- #}
				<div class="card shadow-sm mb-4">
					<div class="card-header">
						<h2 class="h5 mb-0">Enter License</h2>
					</div>
					<div class="card-body">
						<form id="entlic" method="post" action="" enctype="multipart/form-data" novalidate>
							<div class="row g-3">

								<div class="col-12 {% if not IssuerAvailable or LicenseAvailable %}col-md-6{% endif %}">
									<label for="license" class="form-label">License File</label>
									<input name="license" class="form-control" type="file" id="license" required aria-describedby="licenseHelp" accept=".key,.txt">
									<div id="licenseHelp" class="form-text">
										Upload the
										<code>license.key</code>
										file you received from your distributor.
									</div>
								</div>

								{% if not IssuerAvailable %}
									<div class="col-12 col-md-6">
										<label for="issuer" class="form-label">Issuer File</label>
										<input name="issuer" class="form-control" type="file" id="issuer" required aria-describedby="issuerHelp" accept=".pub,.txt">
										<div id="issuerHelp" class="form-text">
											Upload the
											<code>issuer.pub</code>
											file you received from your distributor.
										</div>
									</div>
								{% endif %}

								{% if LicenseAvailable %}
									<div class="col-12 col-md-6">
										<label for="instance" class="form-label">Instance ID</label>
										<input name="instance" class="form-control" type="text" id="instance" required aria-describedby="instanceHelp">
										<div id="instanceHelp" class="form-text">
											Run
											<code>crisp -i</code>
											inside your container to get the Instance ID.
										</div>
									</div>
								{% endif %}

							</div>

							<div class="d-grid mt-4">
								<button class="btn btn-primary" type="submit">Upload</button>
							</div>
						</form>
					</div>
				</div>
			{% endif %}

			{# --- License Server Notice & Manual Refresh ------------------------------ #}
			{% if RequireLicenseServer and LicenseKeyIsDefined %}

				{% if ENV.LICENSE_KEY is defined %}
					<div class="alert alert-warning" role="alert">
						<span>The License Key is configured in the environment variables.</span>
					</div>
				{% endif %}

				<div class="card">
					<div class="card-body">
						<h4 class="alert-heading h5">License server configured</h4>
						<p class="mb-2">
							Your distributor configured a license server. The license updates periodically and on container restart.
						</p>
						<form id="refresh" method="post" action="" enctype="multipart/form-data">
							<div class="d-grid">
								<button class="btn btn-outline-primary" type="submit">Refresh License Now</button>
							</div>
						</form>
					</div>
				</div>
			{% endif %}

		</div>
	</div>
</div>
